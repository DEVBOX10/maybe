<%# locals: (account:) %>

<%= styled_form_with model: account,
                     url: loans_path,
                     scope: :loan,
                     class: "flex flex-col gap-4 justify-between grow",
                     data: { turbo: false } do |f| %>
  <div class="grow space-y-2">
    <%= f.hidden_field :accountable_type %>

    <%= f.text_field :name,
                     placeholder: t(".name_placeholder"),
                     required: "required",
                     label: t(".name_label") %>

    <% if account.new_record? %>
      <%= f.hidden_field :institution_id %>
    <% else %>
      <%= f.collection_select :institution_id,
                            Current.family.institutions.alphabetically,
                            :id, :name,
                            { include_blank: t(".ungrouped"), label: t(".institution") } %>
    <% end %>

    <%= f.money_field :balance,
                      label: t(".balance"),
                      required: true,
                      default_currency: Current.family.currency %>

    <div>
      <hr class="my-4">

      <div class="space-y-2">
        <%= f.fields_for :accountable do |loan_form| %>
          <div class="flex items-center gap-2">
            <%= loan_form.number_field :interest_rate,
                                     label: t(".interest_rate"),
                                     placeholder: t(".interest_rate_placeholder"),
                                     min: 0,
                                     step: 0.01 %>
            <%= loan_form.select :rate_type,
                               [["Fixed", "fixed"], ["Variable", "variable"], ["Adjustable", "adjustable"]],
                               { label: t(".rate_type") } %>
          </div>

          <div class="flex items-center gap-2">
            <%= loan_form.number_field :term_months,
                                     label: t(".term_months"),
                                     placeholder: t(".term_months_placeholder") %>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <%= f.submit %>
<% end %> 